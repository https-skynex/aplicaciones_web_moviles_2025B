<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes de Soporte | Admin Panel</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/dashboard.css">

    <style>
        #sidebar-container { position: fixed; top: 0; left: 0; height: 100vh; z-index: 1000; }
        .main-content { margin-left: 290px; padding: 30px; display: flex; flex-direction: column; gap: 30px; }

        .kpi-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .kpi-card { background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); border-left: 5px solid #007bff; }
        .kpi-card h4 { margin: 0 0 10px 0; color: #555; }
        .kpi-card p { margin: 0; font-size: 2.5em; font-weight: 600; color: #1a2a44; }
        .kpi-card span { font-size: 0.7em; color: #888; }

        .card { background-color: #fff; border-radius: 12px; padding: 1.5em; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        .filters-bar { display: flex; gap: 20px; margin-bottom: 20px; align-items: center; }
        .filters-bar select, .filters-bar input { padding: 8px 12px; border-radius: 8px; border: 1px solid #ccc; }
        
        .support-table { width: 100%; border-collapse: collapse; }
        .support-table th, .support-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        
        .status { padding: 5px 12px; border-radius: 15px; font-weight: 500; font-size: 0.9em; text-align: center; }
        .status.nuevo { background-color: #f8d7da; color: #721c24; }
        .status.pendiente { background-color: #fff3cd; color: #856404; }
        .status.resuelto { background-color: #d4edda; color: #155724; }
        .status.escalado { background-color: #d1ecf1; color: #0c5460; }

        .action-link { color: #007bff; cursor: pointer; text-decoration: underline; margin-right: 10px; }
        
        /* Estilos del Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; display: none; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 500px; }
        .modal-content h3 { margin-top: 0; }
        .modal-content .form-group { margin-bottom: 15px; }
        .modal-content label { display: block; margin-bottom: 5px; }
        .modal-content select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
        .modal-actions { text-align: right; margin-top: 20px; }
        .modal-actions button { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; }
        .modal-actions .btn-save { background-color: #007bff; color: white; }
        .modal-actions .btn-cancel { background-color: #ccc; margin-left: 10px; }
    </style>
</head>
<body>

<div id="assign-modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Asignar Reporte de Soporte</h3>
        <p><strong>Reporte ID:</strong> <span id="modal-report-id"></span></p>
        <div class="form-group">
            <label for="modal-assign-to">Asignar a:</label>
            <select id="modal-assign-to">
                <option>Ana (Soporte N1)</option>
                <option>Carlos (Soporte N1)</option>
                <option>Laura (Soporte Técnico N2)</option>
                <option>Equipo de TI (Escalar)</option>
            </select>
        </div>
        <div class="modal-actions">
            <button id="modal-cancel" class="btn-cancel">Cancelar</button>
            <button id="modal-save" class="btn-save">Asignar</button>
        </div>
    </div>
</div>


<div class="container">
    <div id="sidebar-container"></div>
    <main class="main-content">
        
        <div class="kpi-container">
            <div class="kpi-card">
                <h4>Tickets Nuevos</h4>
                <p>2</p>
                <span>En las últimas 24h</span>
            </div>
            <div class="kpi-card">
                <h4>Tickets Resueltos</h4>
                <p>18</p>
                <span>En las últimas 24h</span>
            </div>
            <div class="kpi-card">
                <h4>Tiempo de Respuesta Prom.</h4>
                <p>2h 15m</p>
                <span>En las últimas 24h</span>
            </div>
        </div>

        <section class="card">
            <div class="filters-bar">
                <select id="status-filter">
                    <option value="todos">Todos los estados</option>
                    <option value="nuevo">Nuevo</option>
                    <option value="pendiente">Pendiente</option>
                    <option value="resuelto">Resuelto</option>
                    <option value="escalado">Escalado</option>
                </select>
                <input type="text" id="search-input" placeholder="Buscar por usuario o asunto...">
            </div>

            <table class="support-table">
                <thead>
                    <tr>
                        <th>ID Reporte</th>
                        <th>Usuario</th>
                        <th>Asunto</th>
                        <th>Fecha</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="support-tbody">
                    <!-- Filas generadas por JS -->
                </tbody>
            </table>
        </section>
    </main>
</div>

<script>
    fetch('../../components/sidebar_admin.html')
        .then(response => response.ok ? response.text() : Promise.reject('Sidebar no encontrado'))
        .then(data => document.getElementById('sidebar-container').innerHTML = data)
        .catch(error => console.error('Error al cargar sidebar:', error));

    const supportTickets = [
        { id: 485, user: 'marta.f@gmail.com', subject: 'Ingreso semanal no se registra', date: '2025-10-18', status: 'nuevo' },
        { id: 486, user: 'juan.p@hotmail.com', subject: 'No puedo editar un gasto guardado', date: '2025-10-18', status: 'pendiente' },
        { id: 487, user: 'ana.g@company.com', subject: 'Sugerencia: Agregar recordatorios', date: '2025-10-17', status: 'resuelto' },
        { id: 488, user: 'carlos.m@yahoo.com', subject: 'Error en el cálculo del resumen mensual', date: '2025-10-17', status: 'escalado' },
        { id: 489, user: 'luis.r@gmail.com', subject: 'Mi categoría de "Mascotas" no aparece', date: '2025-10-16', status: 'resuelto' },
        { id: 490, user: 'maria.l@empresa.com', subject: 'Problema con la frecuencia anual', date: '2025-10-16', status: 'nuevo' }
    ];

    const tbody = document.getElementById('support-tbody');
    const statusFilter = document.getElementById('status-filter');
    const searchInput = document.getElementById('search-input');
    const modal = document.getElementById('assign-modal');

    function renderTable() {
        const filterValue = statusFilter.value;
        const searchValue = searchInput.value.toLowerCase();
        tbody.innerHTML = '';

        supportTickets
            .filter(ticket => 
                (filterValue === 'todos' || ticket.status === filterValue) &&
                (ticket.user.toLowerCase().includes(searchValue) || ticket.subject.toLowerCase().includes(searchValue))
            )
            .forEach(ticket => {
                const row = document.createElement('tr');
                const actions = ticket.status === 'resuelto' 
                    ? `<a class="action-link">Ver</a>` 
                    : `<a class="action-link">Ver</a><a class="action-link assign-link" data-id="${ticket.id}">Asignar</a>`;

                row.innerHTML = `
                    <td>${ticket.id}</td>
                    <td>${ticket.user}</td>
                    <td>${ticket.subject}</td>
                    <td>${ticket.date}</td>
                    <td><span class="status ${ticket.status}">${ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1)}</span></td>
                    <td>${actions}</td>
                `;
                tbody.appendChild(row);
            });
    }
    
    tbody.addEventListener('click', (e) => {
        if (e.target.classList.contains('assign-link')) {
            const ticketId = e.target.dataset.id;
            openAssignModal(ticketId);
        }
    });

    function openAssignModal(ticketId) {
        document.getElementById('modal-report-id').textContent = ticketId;
        modal.style.display = 'flex';
    }

    function closeAssignModal() {
        modal.style.display = 'none';
    }

    document.getElementById('modal-cancel').addEventListener('click', closeAssignModal);
    document.getElementById('modal-save').addEventListener('click', () => {
        // Lógica para guardar la asignación
        console.log("Ticket asignado.");
        closeAssignModal();
    });

    statusFilter.addEventListener('change', renderTable);
    searchInput.addEventListener('input', renderTable);

    window.onload = renderTable;
</script>
</body>
</html>

